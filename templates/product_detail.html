<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ listing.title }} - ReGear</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700;800&display=swap" rel="stylesheet">
    <style>
        * {
            font-family: 'Poppins', sans-serif;
        }

        body {
            background-color: #f8f9fa;
        }

        /* NAVBAR */
        .navbar {
            background-color: #fff !important;
            box-shadow: 0 2px 8px rgba(0,0,0,0.08);
        }

        .navbar-brand {
            font-size: 2rem;
            font-weight: 800;
            color: #002f34 !important;
        }

        .navbar-brand i {
            color: #0066cc;
        }

        .nav-link {
            color: #555 !important;
            font-weight: 500;
            transition: all 0.3s;
        }

        .nav-link:hover {
            color: #0066cc !important;
        }

        .sell-btn {
            background: linear-gradient(135deg, #ffcc00, #ff9900);
            color: #002f34 !important;
            padding: 10px 25px;
            border-radius: 20px;
            font-weight: 700;
            border: none;
            transition: all 0.3s;
            text-decoration: none;
        }

        .sell-btn:hover {
            background: linear-gradient(135deg, #ff9900, #ff6600);
            transform: translateY(-2px);
        }

        /* PRODUCT DETAIL CONTAINER */
        .product-detail-container {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 12px rgba(0,0,0,0.08);
        }

        /* PRODUCT GALLERY */
        .product-gallery {
            position: relative;
            width: 100%;
            height: 400px;
            background: #f5f5f5;
            border-radius: 12px;
            overflow: hidden;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .product-gallery img {
            width: 100%;
            height: 100%;
            object-fit: contain;
            max-width: 100%;
            max-height: 100%;
        }

        .product-gallery-placeholder {
            width: 100%;
            height: 100%;
            display: flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #f5f5f5, #e8e8e8);
            font-size: 5rem;
            color: #ddd;
        }

        .thumbnail-container {
            display: flex;
            gap: 10px;
            padding: 15px;
            overflow-x: auto;
            background: white;
        }

        .thumbnail {
            width: 80px;
            height: 80px;
            border: 2px solid #e8e8e8;
            border-radius: 8px;
            cursor: pointer;
            object-fit: cover;
            transition: all 0.3s;
        }

        .thumbnail:hover,
        .thumbnail.active {
            border-color: #0066cc;
            box-shadow: 0 2px 8px rgba(0,102,204,0.2);
        }

        /* PRICE SECTION */
        .price-section {
            padding: 20px;
            background: white;
            border-radius: 12px;
        }

        .product-price {
            font-size: 2.5rem;
            font-weight: 700;
            color: #0066cc;
            margin-bottom: 5px;
        }

        .price-note {
            font-size: 0.9rem;
            color: #999;
            margin-bottom: 15px;
        }

        /* PRODUCT DETAILS */
        .detail-row {
            display: flex;
            padding: 12px 0;
            border-bottom: 1px solid #f0f0f0;
            align-items: center;
        }

        .detail-row:last-child {
            border-bottom: none;
        }

        .detail-label {
            font-weight: 600;
            color: #666;
            min-width: 150px;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .detail-value {
            color: #333;
            font-weight: 500;
        }

        /* SELLER INFO */
        .seller-card {
            background: white;
            border: 1px solid #e8e8e8;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .seller-header {
            display: flex;
            align-items: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .seller-avatar {
            width: 70px;
            height: 70px;
            border-radius: 50%;
            background: linear-gradient(135deg, #0066cc, #004a99);
            color: white;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 2rem;
            font-weight: 700;
        }

        .seller-info h5 {
            margin: 0;
            font-weight: 700;
            color: #002f34;
        }

        .seller-info p {
            margin: 5px 0 0 0;
            color: #999;
            font-size: 0.9rem;
        }

        /* ACTION BUTTONS */
        .action-buttons {
            display: grid;
            gap: 10px;
        }

        .btn-primary-custom {
            background: linear-gradient(135deg, #0066cc, #004a99);
            color: white;
            border: none;
            padding: 14px 20px;
            border-radius: 8px;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .btn-primary-custom:hover {
            background: linear-gradient(135deg, #004a99, #003366);
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(0,102,204,0.3);
            color: white;
        }

        .btn-outline-primary-custom {
            background: white;
            color: #0066cc;
            border: 2px solid #0066cc;
            padding: 12px 20px;
            border-radius: 8px;
            font-weight: 600;
            text-decoration: none;
            display: inline-flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .btn-outline-primary-custom:hover {
            background: #f0f5ff;
            color: #004a99;
        }

        /* DESCRIPTION */
        .description-section {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-top: 20px;
        }

        .description-section h4 {
            font-weight: 700;
            color: #002f34;
            margin-bottom: 15px;
        }

        .description-section p {
            color: #666;
            line-height: 1.6;
        }

        /* SPECIFICATIONS */
        .specs-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-top: 15px;
        }

        .spec-card {
            background: #f5f5f5;
            border-radius: 8px;
            padding: 15px;
            text-align: center;
        }

        .spec-icon {
            font-size: 1.8rem;
            color: #0066cc;
            margin-bottom: 8px;
        }

        .spec-label {
            font-size: 0.8rem;
            color: #999;
            margin-bottom: 5px;
        }

        .spec-value {
            font-weight: 600;
            color: #333;
            font-size: 1rem;
        }

        /* SAFETY TIPS */
        .safety-tips {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            border-radius: 8px;
            padding: 15px;
            margin-top: 20px;
        }

        .safety-tips h6 {
            font-weight: 700;
            color: #b77d00;
            margin-bottom: 10px;
        }

        .safety-tips ul {
            margin: 0;
            padding-left: 20px;
        }

        .safety-tips li {
            color: #856404;
            font-size: 0.9rem;
            margin-bottom: 5px;
        }

        /* FOOTER */
        footer {
            background-color: #002f34;
            color: white;
            padding: 40px 0 20px;
            margin-top: 40px;
        }

        footer a {
            color: rgba(255,255,255,0.8);
            transition: all 0.3s;
            text-decoration: none;
        }

        footer a:hover {
            color: #ffcc00;
        }

        /* RESPONSIVE */
        @media (max-width: 768px) {
            .product-gallery {
                height: 300px;
            }

            .product-price {
                font-size: 2rem;
            }

            .specs-grid {
                grid-template-columns: repeat(2, 1fr);
            }
        }
    </style>
</head>
<body>
    <!-- NAVBAR -->
    <nav class="navbar navbar-expand-lg navbar-light sticky-top">
        <div class="container-lg">
            <a class="navbar-brand" href="/">
                <i class="fas fa-recycle me-2"></i>ReGear
            </a>
            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarNav">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarNav">
                <ul class="navbar-nav ms-auto align-items-center">
                    <li class="nav-item">
                        <a class="nav-link" href="/">Home</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="/browse">Browse</a>
                    </li>
                    <li class="nav-item wishlist-nav">
                        <button class="navbar-icon-btn wishlist-btn" onclick="toggleWishlist()" title="Wishlist">
                            <i class="fas fa-heart"></i>
                            <span class="navbar-icon-badge" id="wishlistBadge">{{ wishlist_count }}</span>
                        </button>
                    </li>
                    <li class="nav-item">
                        <a href="/sell" class="sell-btn ms-3">
                            <i class="fas fa-plus"></i> Sell
                        </a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>

    <!-- BREADCRUMB -->
    <div class="container-lg mt-4 mb-4">
        <nav aria-label="breadcrumb">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/" class="text-decoration-none">Home</a></li>
                <li class="breadcrumb-item"><a href="/browse" class="text-decoration-none">Browse</a></li>
                <li class="breadcrumb-item"><a href="/browse?category={{ listing.category }}" class="text-decoration-none">{{ listing.category }}</a></li>
                <li class="breadcrumb-item active" aria-current="page">{{ listing.title[:50] }}</li>
            </ol>
        </nav>
    </div>

    <!-- MAIN CONTENT -->
    <div class="container-lg mb-5">
        <div class="row gap-4">
            <!-- LEFT COLUMN: Images & Description -->
            <div class="col-lg-8">
                <!-- Product Gallery -->
                <div class="product-detail-container p-0 mb-4">
                    <div class="product-gallery">
                        {% set img = (listing.photos.split(',')[0] if listing.photos else '') %}
                        {% if img %}
                            <img id="mainImage" src="/{{ img }}" alt="{{ listing.title }}">
                        {% else %}
                            <div class="product-gallery-placeholder">
                                <i class="fas fa-image"></i>
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Thumbnails -->
                    {% if listing.photos %}
                        <div class="thumbnail-container">
                            {% set photo_list = listing.photos.split(',') %}
                            {% for photo in photo_list %}
                                <img src="/{{ photo }}" alt="Thumbnail" class="thumbnail {% if loop.first %}active{% endif %}" onclick="changeImage(this)">
                            {% endfor %}
                        </div>
                    {% endif %}
                </div>

                <!-- Description Section -->
                <div class="description-section">
                    <h4><i class="fas fa-info-circle"></i> About this item</h4>
                    <p>{{ listing.description }}</p>
                    
                    <!-- Key Specifications -->
                    <div class="specs-grid">
                        <div class="spec-card">
                            <div class="spec-icon"><i class="fas fa-cubes"></i></div>
                            <div class="spec-label">Condition</div>
                            <div class="spec-value">{{ listing.item_condition or 'Used' }}</div>
                        </div>
                        <div class="spec-card">
                            <div class="spec-icon"><i class="fas fa-map-marker-alt"></i></div>
                            <div class="spec-label">Location</div>
                            <div class="spec-value">{{ listing.location or 'India' }}</div>
                        </div>
                        <div class="spec-card">
                            <div class="spec-icon"><i class="fas fa-tag"></i></div>
                            <div class="spec-label">Category</div>
                            <div class="spec-value">{{ listing.subcategory or listing.category }}</div>
                        </div>
                        <div class="spec-card">
                            <div class="spec-icon"><i class="fas fa-calendar"></i></div>
                            <div class="spec-label">Posted on</div>
                            <div class="spec-value">{{ listing.created_at.strftime('%d %b %Y') if listing.created_at else 'Recently' }}</div>
                        </div>
                    </div>
                </div>

                <!-- Safety Tips -->
                <div class="safety-tips">
                    <h6><i class="fas fa-shield-alt"></i> Safety Tips</h6>
                    <ul>
                        <li>Meet the seller in a safe, public place</li>
                        <li>Check the item thoroughly before making payment</li>
                        <li>Pay only when you are completely satisfied</li>
                        <li>Always verify the seller's identity and authenticity</li>
                    </ul>
                </div>
            </div>

            <!-- RIGHT COLUMN: Price & Seller Info -->
            <div class="col-lg-4">
                <!-- Price Section -->
                <div class="price-section">
                    <div class="d-flex justify-content-between align-items-center">
                    <div class="product-price">₹{{ listing.price }}</div>
                    <div class="icons">
                        <a href="/wishlist/toggle/{{ listing.id }}" title="Wishlist" class="me-3">
                            <i id="wishlistIcon" class="{% if listing.in_wishlist %}fas{% else %}far{% endif %} fa-heart" style="color:#e63946;"></i>
                        </a>
                        <a href="#" onclick="shareListing()" title="Share">
                            <i class="fas fa-share-alt" style="color:#333;"></i>
                        </a>
                    </div>
                </div>
                <div class="price-note">Fixed Price</div>
                    
                    <div class="detail-row">
                        <span class="detail-label"><i class="fas fa-map-marker-alt"></i> Location:</span>
                        <span class="detail-value">{{ listing.location or 'India' }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label"><i class="fas fa-calendar"></i> Posted:</span>
                        <span class="detail-value">{{ listing.created_at.strftime('%d %b %Y') if listing.created_at else 'Recently' }}</span>
                    </div>
                    <div class="detail-row">
                        <span class="detail-label"><i class="fas fa-cubes"></i> Condition:</span>
                        <span class="detail-value">{{ listing.item_condition or 'Used' }}</span>
                    </div>
                </div>

                <!-- Seller Card -->
                <div class="seller-card">
                    <a href="/seller/{{ listing.user_id }}" class="text-decoration-none text-dark">
                        <div class="seller-header">
                            <div class="seller-avatar">{{ listing.username[0].upper() }}</div>
                            <div class="seller-info">
                                <p class="small text-muted mb-1">Posted by</p>
                                <h5 class="d-inline">{{ listing.username }}</h5>
                                <i class="fas fa-chevron-right ms-2" style="font-size:0.9rem;
                                   vertical-align:middle;color:#666"></i>
                                <p class="mt-1">Verified Seller</p>
                            </div>
                        </div>
                    </a>
                    <!-- membership/date and badge -->
                    <div class="detail-row" style="border: none; padding: 0; margin-bottom: 8px;">
                        <span class="detail-value" style="font-size:0.9rem; color:#666;">
                            Member since {{ listing.seller_joined.strftime('%b %Y') if listing.seller_joined else 'Unknown' }}
                        </span>
                    </div>
                    {% if listing.seller_listings_count is not none %}
                        <div class="detail-row" style="border: none; padding: 0; margin-bottom: 8px;">
                            <span class="detail-value" style="font-size:0.9rem; color:#666;">
                                {{ listing.seller_listings_count }} items listed
                            </span>
                        </div>
                    {% endif %}
                    {% if listing.seller_listings_count and listing.seller_listings_count >= 10 %}
                        <div class="detail-row" style="border: none; padding: 0; margin-bottom: 8px;">
                            <span class="badge bg-primary">ELITE SELLER</span>
                        </div>
                    {% endif %}
                    {% if listing.seller_phone %}
                        <div class="detail-row" style="border: none; padding: 0;">
                            <span class="detail-label"><i class="fas fa-phone"></i></span>
                            <span class="detail-value" id="phoneValue">
                                <a href="#" id="showNumberBtn" data-phone="{{ listing.seller_phone }}" style="color:#0066cc;text-decoration:none;">Show number</a>
                            </span>
                        </div>
                    {% endif %}
                    {% if listing.seller_email %}
                        <div class="detail-row" style="border: none; padding: 0;">
                            <span class="detail-label"><i class="fas fa-envelope"></i></span>
                            <span class="detail-value"><a href="mailto:{{ listing.seller_email }}" style="color: #0066cc; text-decoration: none;">{{ listing.seller_email }}</a></span>
                        </div>
                    {% endif %}
                    <!-- chat button -->
                    {% if listing.status != 'sold' %}
                        <div class="detail-row" style="border: none; padding: 0; margin-top:15px;">
                            <a href="/buy/{{ listing.id }}" class="btn btn-primary btn-sm w-100">
                                <i class="fas fa-comments"></i> Chat with seller
                            </a>
                        </div>
                    {% endif %}
                </div>
            </div>
        </div>
    </div>

    <!-- WISHLIST PANEL -->
    <div id="wishlistPanel" class="navbar-panel hidden" style="position:absolute;top:56px;right:0;z-index:1001;">
        <div class="panel-header">
            <h5>Wishlist</h5>
            <button class="close-btn" onclick="toggleWishlist()">&times;</button>
        </div>
        <div class="panel-content" id="wishlistContent">
            <p class="empty-message">No items in your wishlist yet</p>
        </div>
    </div>

    <!-- FOOTER -->
    <footer>
        <div class="container-lg">
            <div class="row mb-4">
                <div class="col-md-3 mb-3">
                    <h5><i class="fas fa-recycle"></i> ReGear</h5>
                    <p class="small text-white-50">Your trusted marketplace for buying and selling used electronics</p>
                </div>
                <div class="col-md-3 mb-3">
                    <h6>Quick Links</h6>
                    <ul class="list-unstyled small">
                        <li><a href="/">Home</a></li>
                        <li><a href="/browse">Browse</a></li>
                        <li><a href="/sell">Sell Item</a></li>
                    </ul>
                </div>
                <div class="col-md-3 mb-3">
                    <h6>Support</h6>
                    <ul class="list-unstyled small">
                        <li><a href="#">Contact Us</a></li>
                        <li><a href="#">FAQs</a></li>
                        <li><a href="#">Safety Tips</a></li>
                    </ul>
                </div>
                <div class="col-md-3 mb-3">
                    <h6>Legal</h6>
                    <ul class="list-unstyled small">
                        <li><a href="#">Terms & Conditions</a></li>
                        <li><a href="#">Privacy Policy</a></li>
                    </ul>
                </div>
            </div>
            <hr class="bg-white-50">
            <div class="text-center text-white-50 small">
                <p>&copy; 2026 ReGear Inc. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- SCRIPTS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        function changeImage(img) {
            document.getElementById('mainImage').src = img.src;
            document.querySelectorAll('.thumbnail').forEach(t => t.classList.remove('active'));
            img.classList.add('active');
        }
        document.addEventListener('DOMContentLoaded', function(){
            var btn = document.getElementById('showNumberBtn');
            if(btn) {
                btn.addEventListener('click', function(e){
                    e.preventDefault();
                    var phone = this.dataset.phone || '';
                    if(phone) {
                        this.textContent = phone;
                        this.href = 'tel:' + phone;
                    }
                });
            }
        });
        function shareListing(){
            var url = window.location.href;
            if(navigator.share){
                navigator.share({title: document.title, url: url});
            } else {
                navigator.clipboard.writeText(url).then(function(){
                    alert('Link copied to clipboard');
                });
            }
        }
        function toggleWishlist() {
            const panel = document.getElementById('wishlistPanel');
            panel.classList.toggle('hidden');
            if (!panel.classList.contains('hidden')) {
                fetch('/api/wishlist').then(r=>r.json()).then(data=>{
                    const container = document.getElementById('wishlistContent');
                    if (data.length===0) {
                        container.innerHTML = '<p class="empty-message">No items in your wishlist yet</p>';
                    } else {
                        let html='';
                        data.forEach(item=>{ html += `<div class="wishlist-item d-flex align-items-center mb-3">
                                <img class="wishlist-item-image" src="/${item.img}" alt="" />
                                <div class="wishlist-item-info ms-2">
                                    <a href="/listing/${item.id}" class="wishlist-item-name">${item.title}</a>
                                    <div class="wishlist-item-price">₹${item.price}</div>
                                </div>
                              </div>`; });
                        container.innerHTML = html;
                    }
                    document.getElementById('wishlistBadge').textContent = data.length;
                });
            }
        }
    </script>
</body>
</html>
